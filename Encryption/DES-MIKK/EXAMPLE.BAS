DECLARE FUNCTION desdec$ (block$, key$)
DECLARE FUNCTION desenc$ (block$, key$)

REM block$ and key$ 8 bytes each
REM Other functions which do not set up key for each
REM encryption/decryption could be made.

REM: The next two routines should not be called directly, unless
REM: pointers to fixed length strings is used:

DECLARE SUB dessetkey CDECL (BYVAL keyaddr%, BYVAL scheduleaddr%)
DECLARE SUB desencrypt CDECL (BYVAL dataaddr%, BYVAL scheduleaddr%, BYVAL encrypt%)

DECLARE FUNCTION hexxor$ (hexstring1$, hexstring2$)
   REM Strings must be same length.
DECLARE FUNCTION keyparity$ (hexkey$)
   REM Length of hexkey$ must be even
DECLARE FUNCTION hexcomplement$ (hexstring$)
DECLARE FUNCTION bytetohex$ (bytestring$)
DECLARE FUNCTION hextobyte$ (hexstring$)
   REM Length of hexstring$ must be even
DECLARE FUNCTION randomhexa$ (length%)
   REM Use RANDOMIZE TIMER before call to randomhexa$

PRINT "   Key              In               Expected out     Result"

DO
    READ encrypt%
    IF encrypt% = -1 THEN EXIT DO
    READ teststring$
    inputstring$ = MID$(teststring$, 18, 16)
    expectedout$ = MID$(teststring$, 35, 16)
    key$ = MID$(teststring$, 1, 16)
    IF encrypt% = 1 THEN
        PRINT "En ";  ' for encryption
        result$ = bytetohex$(desenc$(hextobyte$(inputstring$), hextobyte$(key$)))
    ELSE
        PRINT "De ";  ' for decryption
        result$ = bytetohex$(desdec$(hextobyte$(inputstring$), hextobyte$(key$)))
    END IF
    PRINT teststring$; " ";
    PRINT result$; " ";
    IF expectedout$ = result$ THEN
        PRINT "Ok"
    ELSE
        PRINT "Error"
    END IF
LOOP

PRINT "   Key              In               Expected out     Result"


REM DES test data found in sci.crypt:

REM 1 for encrypt
REM      Key              In               Out
DATA 1, "0101010101010101 95F8A5E5DD31D900 8000000000000000"
DATA 1, "0101010101010101 DD7F121CA5015619 4000000000000000"
DATA 1, "0101010101010101 2E8653104F3834EA 2000000000000000"
DATA 1, "0101010101010101 4BD388FF6CD81D4F 1000000000000000"
DATA 1, "0101010101010101 20B9E767B2FB1456 0800000000000000"
DATA 1, "0101010101010101 55579380D77138EF 0400000000000000"
DATA 1, "0101010101010101 6CC5DEFAAF04512F 0200000000000000"
DATA 1, "0101010101010101 0D9F279BA5D87260 0100000000000000"
DATA 1, "0101010101010101 D9031B0271BD5A0A 0080000000000000"
DATA 1, "0101010101010101 424250B37C3DD951 0040000000000000"
DATA 1, "0101010101010101 B8061B7ECD9A21E5 0020000000000000"
DATA 1, "0101010101010101 F15D0F286B65BD28 0010000000000000"
DATA 1, "0101010101010101 ADD0CC8D6E5DEBA1 0008000000000000"
DATA 1, "0101010101010101 E6D5F82752AD63D1 0004000000000000"
DATA 1, "0101010101010101 ECBFE3BD3F591A5E 0002000000000000"
DATA 1, "0101010101010101 F356834379D165CD 0001000000000000"
DATA 1, "0101010101010101 2B9F982F20037FA9 0000800000000000"
DATA 1, "0101010101010101 889DE068A16F0BE6 0000400000000000"
DATA 1, "0101010101010101 E19E275D846A1298 0000200000000000"
DATA 1, "0101010101010101 329A8ED523D71AEC 0000100000000000"
DATA 1, "0101010101010101 E7FCE22557D23C97 0000080000000000"
DATA 1, "0101010101010101 12A9F5817FF2D65D 0000040000000000"
DATA 1, "0101010101010101 A484C3AD38DC9C19 0000020000000000"
DATA 1, "0101010101010101 FBE00A8A1EF8AD72 0000010000000000"
DATA 1, "0101010101010101 750D079407521363 0000008000000000"
DATA 1, "0101010101010101 64FEED9C724C2FAF 0000004000000000"
DATA 1, "0101010101010101 F02B263B328E2B60 0000002000000000"
DATA 1, "0101010101010101 9D64555A9A10B852 0000001000000000"
DATA 1, "0101010101010101 D106FF0BED5255D7 0000000800000000"
DATA 1, "0101010101010101 E1652C6B138C64A5 0000000400000000"
DATA 1, "0101010101010101 E428581186EC8F46 0000000200000000"
DATA 1, "0101010101010101 AEB5F5EDE22D1A36 0000000100000000"
DATA 1, "0101010101010101 E943D7568AEC0C5C 0000000080000000"
DATA 1, "0101010101010101 DF98C8276F54B04B 0000000040000000"
DATA 1, "0101010101010101 B160E4680F6C696F 0000000020000000"
DATA 1, "0101010101010101 FA0752B07D9C4AB8 0000000010000000"
DATA 1, "0101010101010101 CA3A2B036DBC8502 0000000008000000"
DATA 1, "0101010101010101 5E0905517BB59BCF 0000000004000000"
DATA 1, "0101010101010101 814EEB3B91D90726 0000000002000000"
DATA 1, "0101010101010101 4D49DB1532919C9F 0000000001000000"
DATA 1, "0101010101010101 25EB5FC3F8CF0621 0000000000800000"
DATA 1, "0101010101010101 AB6A20C0620D1C6F 0000000000400000"
DATA 1, "0101010101010101 79E90DBC98F92CCA 0000000000200000"
DATA 1, "0101010101010101 866ECEDD8072BB0E 0000000000100000"
DATA 1, "0101010101010101 8B54536F2F3E64A8 0000000000080000"
DATA 1, "0101010101010101 EA51D3975595B86B 0000000000040000"
DATA 1, "0101010101010101 CAFFC6AC4542DE31 0000000000020000"
DATA 1, "0101010101010101 8DD45A2DDF90796C 0000000000010000"
DATA 1, "0101010101010101 1029D55E880EC2D0 0000000000008000"
DATA 1, "0101010101010101 5D86CB23639DBEA9 0000000000004000"
DATA 1, "0101010101010101 1D1CA853AE7C0C5F 0000000000002000"
DATA 1, "0101010101010101 CE332329248F3228 0000000000001000"
DATA 1, "0101010101010101 8405D1ABE24FB942 0000000000000800"
DATA 1, "0101010101010101 E643D78090CA4207 0000000000000400"
DATA 1, "0101010101010101 48221B9937748A23 0000000000000200"
DATA 1, "0101010101010101 DD7C0BBD61FAFD54 0000000000000100"
DATA 1, "0101010101010101 2FBC291A570DB5C4 0000000000000080"
DATA 1, "0101010101010101 E07C30D7E4E26E12 0000000000000040"
DATA 1, "0101010101010101 0953E2258E8E90A1 0000000000000020"
DATA 1, "0101010101010101 5B711BC4CEEBF2EE 0000000000000010"
DATA 1, "0101010101010101 CC083F1E6D9E85F6 0000000000000008"
DATA 1, "0101010101010101 D2FD8867D50D2DFE 0000000000000004"
DATA 1, "0101010101010101 06E7EA22CE92708F 0000000000000002"
DATA 1, "0101010101010101 166B40B44ABA4BD6 0000000000000001"
                                                 
REM    Inverse Permutation and Expansion test

DATA 1, "0101010101010101 8000000000000000 95F8A5E5DD31D900"
DATA 1, "0101010101010101 4000000000000000 DD7F121CA5015619"
DATA 1, "0101010101010101 2000000000000000 2E8653104F3834EA"
DATA 1, "0101010101010101 1000000000000000 4BD388FF6CD81D4F"
DATA 1, "0101010101010101 0800000000000000 20B9E767B2FB1456"
DATA 1, "0101010101010101 0400000000000000 55579380D77138EF"
DATA 1, "0101010101010101 0200000000000000 6CC5DEFAAF04512F"
DATA 1, "0101010101010101 0100000000000000 0D9F279BA5D87260"
DATA 1, "0101010101010101 0080000000000000 D9031B0271BD5A0A"
DATA 1, "0101010101010101 0040000000000000 424250B37C3DD951"
DATA 1, "0101010101010101 0020000000000000 B8061B7ECD9A21E5"
DATA 1, "0101010101010101 0010000000000000 F15D0F286B65BD28"
DATA 1, "0101010101010101 0008000000000000 ADD0CC8D6E5DEBA1"
DATA 1, "0101010101010101 0004000000000000 E6D5F82752AD63D1"
DATA 1, "0101010101010101 0002000000000000 ECBFE3BD3F591A5E"
DATA 1, "0101010101010101 0001000000000000 F356834379D165CD"
DATA 1, "0101010101010101 0000800000000000 2B9F982F20037FA9"
DATA 1, "0101010101010101 0000400000000000 889DE068A16F0BE6"
DATA 1, "0101010101010101 0000200000000000 E19E275D846A1298"
DATA 1, "0101010101010101 0000100000000000 329A8ED523D71AEC"
DATA 1, "0101010101010101 0000080000000000 E7FCE22557D23C97"
DATA 1, "0101010101010101 0000040000000000 12A9F5817FF2D65D"
DATA 1, "0101010101010101 0000020000000000 A484C3AD38DC9C19"
DATA 1, "0101010101010101 0000010000000000 FBE00A8A1EF8AD72"
DATA 1, "0101010101010101 0000008000000000 750D079407521363"
DATA 1, "0101010101010101 0000004000000000 64FEED9C724C2FAF"
DATA 1, "0101010101010101 0000002000000000 F02B263B328E2B60"
DATA 1, "0101010101010101 0000001000000000 9D64555A9A10B852"
DATA 1, "0101010101010101 0000000800000000 D106FF0BED5255D7"
DATA 1, "0101010101010101 0000000400000000 E1652C6B138C64A5"
DATA 1, "0101010101010101 0000000200000000 E428581186EC8F46"
DATA 1, "0101010101010101 0000000100000000 AEB5F5EDE22D1A36"
DATA 1, "0101010101010101 0000000080000000 E943D7568AEC0C5C"
DATA 1, "0101010101010101 0000000040000000 DF98C8276F54B04B"
DATA 1, "0101010101010101 0000000020000000 B160E4680F6C696F"
DATA 1, "0101010101010101 0000000010000000 FA0752B07D9C4AB8"
DATA 1, "0101010101010101 0000000008000000 CA3A2B036DBC8502"
DATA 1, "0101010101010101 0000000004000000 5E0905517BB59BCF"
DATA 1, "0101010101010101 0000000002000000 814EEB3B91D90726"
DATA 1, "0101010101010101 0000000001000000 4D49DB1532919C9F"
DATA 1, "0101010101010101 0000000000800000 25EB5FC3F8CF0621"
DATA 1, "0101010101010101 0000000000400000 AB6A20C0620D1C6F"
DATA 1, "0101010101010101 0000000000200000 79E90DBC98F92CCA"
DATA 1, "0101010101010101 0000000000100000 866ECEDD8072BB0E"
DATA 1, "0101010101010101 0000000000080000 8B54536F2F3E64A8"
DATA 1, "0101010101010101 0000000000040000 EA51D3975595B86B"
DATA 1, "0101010101010101 0000000000020000 CAFFC6AC4542DE31"
DATA 1, "0101010101010101 0000000000010000 8DD45A2DDF90796C"
DATA 1, "0101010101010101 0000000000008000 1029D55E880EC2D0"
DATA 1, "0101010101010101 0000000000004000 5D86CB23639DBEA9"
DATA 1, "0101010101010101 0000000000002000 1D1CA853AE7C0C5F"
DATA 1, "0101010101010101 0000000000001000 CE332329248F3228"
DATA 1, "0101010101010101 0000000000000800 8405D1ABE24FB942"
DATA 1, "0101010101010101 0000000000000400 E643D78090CA4207"
DATA 1, "0101010101010101 0000000000000200 48221B9937748A23"
DATA 1, "0101010101010101 0000000000000100 DD7C0BBD61FAFD54"
DATA 1, "0101010101010101 0000000000000080 2FBC291A570DB5C4"
DATA 1, "0101010101010101 0000000000000040 E07C30D7E4E26E12"
DATA 1, "0101010101010101 0000000000000020 0953E2258E8E90A1"
DATA 1, "0101010101010101 0000000000000010 5B711BC4CEEBF2EE"
DATA 1, "0101010101010101 0000000000000008 CC083F1E6D9E85F6"
DATA 1, "0101010101010101 0000000000000004 D2FD8867D50D2DFE"
DATA 1, "0101010101010101 0000000000000002 06E7EA22CE92708F"
DATA 1, "0101010101010101 0000000000000001 166B40B44ABA4BD6"
                                                 
REM   Key Permutation tests


DATA 1, "8001010101010101 0000000000000000 95A8D72813DAA94D"
DATA 1, "4001010101010101 0000000000000000 0EEC1487DD8C26D5"
DATA 1, "2001010101010101 0000000000000000 7AD16FFB79C45926"
DATA 1, "1001010101010101 0000000000000000 D3746294CA6A6CF3"
DATA 1, "0801010101010101 0000000000000000 809F5F873C1FD761"
DATA 1, "0401010101010101 0000000000000000 C02FAFFEC989D1FC"
DATA 1, "0201010101010101 0000000000000000 4615AA1D33E72F10"
DATA 1, "0180010101010101 0000000000000000 2055123350C00858"
DATA 1, "0140010101010101 0000000000000000 DF3B99D6577397C8"
DATA 1, "0120010101010101 0000000000000000 31FE17369B5288C9"
DATA 1, "0110010101010101 0000000000000000 DFDD3CC64DAE1642"
DATA 1, "0108010101010101 0000000000000000 178C83CE2B399D94"
DATA 1, "0104010101010101 0000000000000000 50F636324A9B7F80"
DATA 1, "0102010101010101 0000000000000000 A8468EE3BC18F06D"
DATA 1, "0101800101010101 0000000000000000 A2DC9E92FD3CDE92"
DATA 1, "0101400101010101 0000000000000000 CAC09F797D031287"
DATA 1, "0101200101010101 0000000000000000 90BA680B22AEB525"
DATA 1, "0101100101010101 0000000000000000 CE7A24F350E280B6"
DATA 1, "0101080101010101 0000000000000000 882BFF0AA01A0B87"
DATA 1, "0101040101010101 0000000000000000 25610288924511C2"
DATA 1, "0101020101010101 0000000000000000 C71516C29C75D170"
DATA 1, "0101018001010101 0000000000000000 5199C29A52C9F059"
DATA 1, "0101014001010101 0000000000000000 C22F0A294A71F29F"
DATA 1, "0101012001010101 0000000000000000 EE371483714C02EA"
DATA 1, "0101011001010101 0000000000000000 A81FBD448F9E522F"
DATA 1, "0101010801010101 0000000000000000 4F644C92E192DFED"
DATA 1, "0101010401010101 0000000000000000 1AFA9A66A6DF92AE"
DATA 1, "0101010201010101 0000000000000000 B3C1CC715CB879D8"
DATA 1, "0101010180010101 0000000000000000 19D032E64AB0BD8B"
DATA 1, "0101010140010101 0000000000000000 3CFAA7A7DC8720DC"
DATA 1, "0101010120010101 0000000000000000 B7265F7F447AC6F3"
DATA 1, "0101010110010101 0000000000000000 9DB73B3C0D163F54"
DATA 1, "0101010108010101 0000000000000000 8181B65BABF4A975"
DATA 1, "0101010104010101 0000000000000000 93C9B64042EAA240"
DATA 1, "0101010102010101 0000000000000000 5570530829705592"
DATA 1, "0101010101800101 0000000000000000 8638809E878787A0"
DATA 1, "0101010101400101 0000000000000000 41B9A79AF79AC208"
DATA 1, "0101010101200101 0000000000000000 7A9BE42F2009A892"
DATA 1, "0101010101100101 0000000000000000 29038D56BA6D2745"
DATA 1, "0101010101080101 0000000000000000 5495C6ABF1E5DF51"
DATA 1, "0101010101040101 0000000000000000 AE13DBD561488933"
DATA 1, "0101010101020101 0000000000000000 024D1FFA8904E389"
DATA 1, "0101010101018001 0000000000000000 D1399712F99BF02E"
DATA 1, "0101010101014001 0000000000000000 14C1D7C1CFFEC79E"
DATA 1, "0101010101012001 0000000000000000 1DE5279DAE3BED6F"
DATA 1, "0101010101011001 0000000000000000 E941A33F85501303"
DATA 1, "0101010101010801 0000000000000000 DA99DBBC9A03F379"
DATA 1, "0101010101010401 0000000000000000 B7FC92F91D8E92E9"
DATA 1, "0101010101010201 0000000000000000 AE8E5CAA3CA04E85"
DATA 1, "0101010101010180 0000000000000000 9CC62DF43B6EED74"
DATA 1, "0101010101010140 0000000000000000 D863DBB5C59A91A0"
DATA 1, "0101010101010120 0000000000000000 A1AB2190545B91D7"
DATA 1, "0101010101010110 0000000000000000 0875041E64C570F7"
DATA 1, "0101010101010108 0000000000000000 5A594528BEBEF1CC"
DATA 1, "0101010101010104 0000000000000000 FCDB3291DE21F0C0"
DATA 1, "0101010101010102 0000000000000000 869EFD7F9F265A09"
                                                 
REM   Test of right-shifts in Decryption

DATA 0, "8001010101010101 95A8D72813DAA94D 0000000000000000"
DATA 0, "4001010101010101 0EEC1487DD8C26D5 0000000000000000"
DATA 0, "2001010101010101 7AD16FFB79C45926 0000000000000000"
DATA 0, "1001010101010101 D3746294CA6A6CF3 0000000000000000"
DATA 0, "0801010101010101 809F5F873C1FD761 0000000000000000"
DATA 0, "0401010101010101 C02FAFFEC989D1FC 0000000000000000"
DATA 0, "0201010101010101 4615AA1D33E72F10 0000000000000000"
DATA 0, "0180010101010101 2055123350C00858 0000000000000000"
DATA 0, "0140010101010101 DF3B99D6577397C8 0000000000000000"
DATA 0, "0120010101010101 31FE17369B5288C9 0000000000000000"
DATA 0, "0110010101010101 DFDD3CC64DAE1642 0000000000000000"
DATA 0, "0108010101010101 178C83CE2B399D94 0000000000000000"
DATA 0, "0104010101010101 50F636324A9B7F80 0000000000000000"
DATA 0, "0102010101010101 A8468EE3BC18F06D 0000000000000000"
DATA 0, "0101800101010101 A2DC9E92FD3CDE92 0000000000000000"
DATA 0, "0101400101010101 CAC09F797D031287 0000000000000000"
DATA 0, "0101200101010101 90BA680B22AEB525 0000000000000000"
DATA 0, "0101100101010101 CE7A24F350E280B6 0000000000000000"
DATA 0, "0101080101010101 882BFF0AA01A0B87 0000000000000000"
DATA 0, "0101040101010101 25610288924511C2 0000000000000000"
DATA 0, "0101020101010101 C71516C29C75D170 0000000000000000"
DATA 0, "0101018001010101 5199C29A52C9F059 0000000000000000"
DATA 0, "0101014001010101 C22F0A294A71F29F 0000000000000000"
DATA 0, "0101012001010101 EE371483714C02EA 0000000000000000"
DATA 0, "0101011001010101 A81FBD448F9E522F 0000000000000000"
DATA 0, "0101010801010101 4F644C92E192DFED 0000000000000000"
DATA 0, "0101010401010101 1AFA9A66A6DF92AE 0000000000000000"
DATA 0, "0101010201010101 B3C1CC715CB879D8 0000000000000000"
DATA 0, "0101010180010101 19D032E64AB0BD8B 0000000000000000"
DATA 0, "0101010140010101 3CFAA7A7DC8720DC 0000000000000000"
DATA 0, "0101010120010101 B7265F7F447AC6F3 0000000000000000"
DATA 0, "0101010110010101 9DB73B3C0D163F54 0000000000000000"
DATA 0, "0101010108010101 8181B65BABF4A975 0000000000000000"
DATA 0, "0101010104010101 93C9B64042EAA240 0000000000000000"
DATA 0, "0101010102010101 5570530829705592 0000000000000000"
DATA 0, "0101010101800101 8638809E878787A0 0000000000000000"
DATA 0, "0101010101400101 41B9A79AF79AC208 0000000000000000"
DATA 0, "0101010101200101 7A9BE42F2009A892 0000000000000000"
DATA 0, "0101010101100101 29038D56BA6D2745 0000000000000000"
DATA 0, "0101010101080101 5495C6ABF1E5DF51 0000000000000000"
DATA 0, "0101010101040101 AE13DBD561488933 0000000000000000"
DATA 0, "0101010101020101 024D1FFA8904E389 0000000000000000"
DATA 0, "0101010101018001 D1399712F99BF02E 0000000000000000"
DATA 0, "0101010101014001 14C1D7C1CFFEC79E 0000000000000000"
DATA 0, "0101010101012001 1DE5279DAE3BED6F 0000000000000000"
DATA 0, "0101010101011001 E941A33F85501303 0000000000000000"
DATA 0, "0101010101010801 DA99DBBC9A03F379 0000000000000000"
DATA 0, "0101010101010401 B7FC92F91D8E92E9 0000000000000000"
DATA 0, "0101010101010201 AE8E5CAA3CA04E85 0000000000000000"
DATA 0, "0101010101010180 9CC62DF43B6EED74 0000000000000000"
DATA 0, "0101010101010140 D863DBB5C59A91A0 0000000000000000"
DATA 0, "0101010101010120 A1AB2190545B91D7 0000000000000000"
DATA 0, "0101010101010110 0875041E64C570F7 0000000000000000"
DATA 0, "0101010101010108 5A594528BEBEF1CC 0000000000000000"
DATA 0, "0101010101010104 FCDB3291DE21F0C0 0000000000000000"
DATA 0, "0101010101010102 869EFD7F9F265A09 0000000000000000"
                                                
REM    Data permutation test

DATA 1, "1046913489980131 0000000000000000 88D55E54F54C97B4"
DATA 1, "1007103489988020 0000000000000000 0C0CC00C83EA48FD"
DATA 1, "10071034C8980120 0000000000000000 83BC8EF3A6570183"
DATA 1, "1046103489988020 0000000000000000 DF725DCAD94EA2E9"
DATA 1, "1086911519190101 0000000000000000 E652B53B550BE8B0"
DATA 1, "1086911519580101 0000000000000000 AF527120C485CBB0"
DATA 1, "5107B01519580101 0000000000000000 0F04CE393DB926D5"
DATA 1, "1007B01519190101 0000000000000000 C9F00FFC74079067"
DATA 1, "3107915498080101 0000000000000000 7CFD82A593252B4E"
DATA 1, "3107919498080101 0000000000000000 CB49A2F9E91363E3"
DATA 1, "10079115B9080140 0000000000000000 00B588BE70D23F56"
DATA 1, "3107911598080140 0000000000000000 406A9A6AB43399AE"
DATA 1, "1007D01589980101 0000000000000000 6CB773611DCA9ADA"
DATA 1, "9107911589980101 0000000000000000 67FD21C17DBB5D70"
DATA 1, "9107D01589190101 0000000000000000 9592CB4110430787"
DATA 1, "1007D01598980120 0000000000000000 A6B7FF68A318DDD3"
DATA 1, "1007940498190101 0000000000000000 4D102196C914CA16"
DATA 1, "0107910491190401 0000000000000000 2DFA9F4573594965"
DATA 1, "0107910491190101 0000000000000000 B46604816C0E0774"
DATA 1, "0107940491190401 0000000000000000 6E7E6221A4F34E87"
DATA 1, "19079210981A0101 0000000000000000 AA85E74643233199"
DATA 1, "1007911998190801 0000000000000000 2E5A19DB4D1962D6"
DATA 1, "10079119981A0801 0000000000000000 23A866A809D30894"
DATA 1, "1007921098190101 0000000000000000 D812D961F017D320"
DATA 1, "100791159819010B 0000000000000000 055605816E58608F"
DATA 1, "1004801598190101 0000000000000000 ABD88E8B1B7716F1"
DATA 1, "1004801598190102 0000000000000000 537AC95BE69DA1E1"
DATA 1, "1004801598190108 0000000000000000 AED0F6AE3C25CDD8"
DATA 1, "1002911598100104 0000000000000000 B3E35A5EE53E7B8D"
DATA 1, "1002911598190104 0000000000000000 61C79C71921A2EF8"
DATA 1, "1002911598100201 0000000000000000 E2F5728F0995013C"
DATA 1, "1002911698100101 0000000000000000 1AEAC39A61F0A464"
                                                
REM    S-Box test

DATA 1, "7CA110454A1A6E57 01A1D6D039776742 690F5B0D9A26939B"
DATA 1, "0131D9619DC1376E 5CD54CA83DEF57DA 7A389D10354BD271"
DATA 1, "07A1133E4A0B2686 0248D43806F67172 868EBB51CAB4599A"
DATA 1, "3849674C2602319E 51454B582DDF440A 7178876E01F19B2A"
DATA 1, "04B915BA43FEB5B6 42FD443059577FA2 AF37FB421F8C4095"
DATA 1, "0113B970FD34F2CE 059B5E0851CF143A 86A560F10EC6D85B"
DATA 1, "0170F175468FB5E6 0756D8E0774761D2 0CD3DA020021DC09"
DATA 1, "43297FAD38E373FE 762514B829BF486A EA676B2CB7DB2B7A"
DATA 1, "07A7137045DA2A16 3BDD119049372802 DFD64A815CAF1A0F"
DATA 1, "04689104C2FD3B2F 26955F6835AF609A 5C513C9C4886C088"
DATA 1, "37D06BB516CB7546 164D5E404F275232 0A2AEEAE3FF4AB77"
DATA 1, "1F08260D1AC2465E 6B056E18759F5CCA EF1BF03E5DFA575A"
DATA 1, "584023641ABA6176 004BD6EF09176062 88BF0DB6D70DEE56"
DATA 1, "025816164629B007 480D39006EE762F2 A1F9915541020B56"
DATA 1, "49793EBC79B3258F 437540C8698F3CFA 6FBF1CAFCFFD0556"
DATA 1, "4FB05E1515AB73A7 072D43A077075292 2F22E49BAB7CA1AC"
DATA 1, "49E95D6D4CA229BF 02FE55778117F12A 5A6B612CC26CCE4A"
DATA 1, "018310DC409B26D6 1D9D5C5018F728C2 5F4C038ED12B2E41"
DATA 1, "1C587F1C13924FEF 305532286D6F295A 63FAC0D034D9F793"
DATA -1

FUNCTION bytetohex$ (bytestring$)

hexstring$ = ""

FOR byteno% = 1 TO LEN(bytestring$)
   twodigits$ = RIGHT$("0" + HEX$(ASC(MID$(bytestring$, byteno%, 1))), 2)
   hexstring$ = hexstring$ + twodigits$
NEXT

bytetohex$ = hexstring$

END FUNCTION

FUNCTION desdec$ (block$, key$)


DIM descipher AS STRING * 8
DIM deskey AS STRING * 8
DIM schedule AS STRING * 512 ' suppose only 128 byte is needed.

descipher = block$
deskey = key$

dessetkey VARPTR(deskey), VARPTR(schedule)
desencrypt VARPTR(descipher), VARPTR(schedule), 0

desdec$ = descipher

END FUNCTION

FUNCTION desenc$ (block$, key$)

DIM desplain AS STRING * 8
DIM deskey AS STRING * 8
DIM schedule AS STRING * 512   ' suppose only 128 byte is needed.

desplain = block$
deskey = key$

dessetkey VARPTR(deskey), VARPTR(schedule)
desencrypt VARPTR(desplain), VARPTR(schedule), 1

desenc$ = desplain

END FUNCTION

FUNCTION hexcomplement$ (hexstring$)

length% = LEN(hexstring$)
hexcomplement1$ = ""

FOR digitno% = 1 TO length%
   compbyte$ = HEX$(VAL("&H" + MID$(hexstring$, digitno%, 1)) XOR 15)
   hexcomplement1$ = hexcomplement1$ + compbyte$
NEXT

hexcomplement$ = hexcomplement1$

END FUNCTION

FUNCTION hextobyte$ (hexstring$)

   hextobyte1$ = ""

   FOR digitno% = 1 TO LEN(hexstring$) \ 2
      ii$ = MID$(hexstring$, (digitno% - 1) * 2 + 1, 2)
      hextobyte1$ = hextobyte1$ + CHR$(VAL("&H" + ii$))
   NEXT

   hextobyte$ = hextobyte1$

END FUNCTION

FUNCTION hexxor$ (hexstring1$, hexstring2$)

hexxor1$ = ""

FOR i% = 1 TO LEN(hexstring1$)

   value1% = VAL("&H" + MID$(hexstring1$, i%, 1))
   value2% = VAL("&H" + MID$(hexstring2$, i%, 1))
   valuexor% = value1% XOR value2%
   hexxor1$ = hexxor1$ + HEX$(valuexor%)

NEXT

hexxor$ = hexxor1$

END FUNCTION

FUNCTION keyparity$ (hexkey$)

key$ = hexkey$

FOR i% = 1 TO LEN(hexkey$) \ 2

   bytevalue% = VAL("&H" + MID$(key$, (i% - 1) * 2 + 1, 2))
   iii% = bytevalue%
   numberofbits% = 0

   FOR bitno% = 1 TO 8
      IF (iii% AND 1) = 1 THEN numberofbits% = numberofbits% + 1
      iii% = iii% \ 2
   NEXT

   IF numberofbits% MOD 2 = 0 THEN
      bytevalue% = bytevalue% XOR 1
   END IF

   MID$(key$, (i% - 1) * 2 + 1, 2) = RIGHT$("0" + HEX$(bytevalue%), 2)

NEXT

keyparity$ = key$

END FUNCTION

FUNCTION randomhexa$ (length%)

   randomhexa1$ = ""

   FOR digitno% = 1 TO length%

      randomno% = INT(RND * 16)
      IF randomno% = 16 THEN randomno% = 15
      randomhexa1$ = randomhexa1$ + HEX$(randomno%)

   NEXT

   randomhexa$ = randomhexa1$

END FUNCTION

